# Human Simulation

## 1. Set Up API Keys

Create a `.env` file in `/path/to/coopera_code/habitat-lab`. Add the following lines:

```bash
OPENAI_API_KEY=...
HUGGINGFACE_TOKEN=...
```

## 2. Download Our Curated Human Motion Dataset

For free-form human motion, COOPERA uses a curated subset of motions from the [Motion-X](https://github.com/IDEA-Research/Motion-X) dataset, combining sequences from four sources: HAA500, HuMMan, IDEA400, and Perform (see details in the paper Sections 3.2, 4.2, and Appendix C.2). 

Download our curated motion dataset [here](https://drive.google.com/file/d/1m--rN-GFn6AN_g2LhjOkZ1xz1ic_G5hh/view?usp=drive_link). place the `all_motion` folder as: `/path/to/coopera_code/habitat-lab/data/humanoids/humanoid_data/all_motion`. You can extend this dataset by adding additional motions, as long as they follow the SMPL-X format.

## 3. Download Human Datasets

We provide simulated humans generated by GPT in JSON format. Download from [here](https://drive.google.com/file/d/15RL0CSfSxi_7trH4FIgcsIHnbK22Jpsx/view?usp=drive_link). Place the `human` folder as: `/path/to/coopera_code/habitat-lab/results/human`.

If you wish to simulate more diverse humans, you may use the following datasets:

1) **Facebook MyPersonality Datset**: Download from the [official archive](https://web.archive.org/web/20180428085315/http://mypersonality.org/wiki/doku.php?id=download_databases#datasets_available_without_registration) (find WCPR13, then the file “10,000 Facebook status updates of 250 users + personality + Facebook social network properties”) or from [here](https://drive.google.com/file/d/1FV10BkOWOmRfyTz1F_znz558eeyBsQe6/view?usp=drive_link). Place the `mypersonality_final.csv` file as: `/path/to/coopera_code/habitat-lab/data/humanoids/humanoid_data/mypersonality_final.csv`.

⚠️Caution: This dataset contains real user information. We **do not** encourage its use. Read the [official ethics note](https://sites.google.com/michalkosinski.com/mypersonality) for more details.

2) **Google: Synthetic-Persona-Chat Dataset**: Download from the [official repository](https://github.com/google-research-datasets/Synthetic-Persona-Chat) or from [here](https://drive.google.com/file/d/1OEhnUNFIkaFDZba9RtY_6PwcjcJ0831k/view?usp=sharing). Manually create the human description paragraph and Big-5 personality scores following the procedures described in our paper (Sections 3.2, Appendix C, and F). Afterward, overwrite the variables `profile_string_list` and `big_five_list` in `/path/to/coopera_code/habitat-lab/coopera_main/human_sim/human_sim.py` (see below Part 5: Simulating Humans).

## 4. Generate Dynamic Scenes and Episode Datasets

To create dynamic Habitat Synthetic Scenes for collaboration type 1, run the following command (see paper Sections 4.1 and Appendix B for details):

```bash
python coopera_main/create_dynamic_hssd.py
```

To generate new episode datasets (i.e., adding more dynamic objects into scenes from the YCB dataset), as described in paper Section 4.1, follow the [offifical instruction](https://huggingface.co/datasets/ai-habitat/hab3_bench_assets) and run:

```bash
python -u habitat-lab/habitat/datasets/rearrange/run_episode_generator.py
```

⚠️The full episode generation process involves multiple steps: setting parameters, moving the generated folder `episode_datasets` from `/path/to/coopera_code/habitat-lab/data/hab3_bench_assets` to `/path/to/coopera_code/habitat-lab/data/scene_datasets/hssd-hab`, and manually updating the path keys in the generated JSON files. There are also multiple reports from users that different Habitat versions may cause errors during this process, making it difficult to reproduce reliably.

Thus, we recommend downloading our pre-generated and modified episode datasets instead. Download from [this link](https://drive.google.com/file/d/1-LKntbaHxZ3YIGRVPdUVe36QV2-FKtG4/view?usp=drive_link) and [this link](https://drive.google.com/file/d/1SY_rwBX2zhhKLmhotU0roozg4jER82yE/view?usp=sharing). Place the folders as follows: `/path/to/coopera_code/habitat-lab/data/scene_datasets/hssd-hab/episode_datasets`, `/path/to/coopera_code/habitat-lab/data/scene_datasets/hssd-hab/episode_datasets_dynamic`.

## 5. Simulating Humans

```bash
export QT_QPA_PLATFORM="offscreen"
export TOKENIZERS_PARALLELISM="false"
CUDA_VISIBLE_DEVICES="X,Y,..." python coopera_main/human_sim/human_sim.py [OPTIONS]
```

**Options**
**Core Configuration**
- `--use-gpt-human [True/False]` - Use GPT or Llama for human simulation (default: true)
- `--start-logic-human [True/False]` - Restart human simulation (default: true)
- `--collab-type [1/2]` - Collaboration type (default: 2)

**Loop Limits**
- `--max-scenes N` - Stop after N scenes (default: 5)
- `--max-profiles N` - Stop after N profiles (default: 10)
- `--max-days N` - Stop after N days (default: 5)

**Specific Processing**
- `--scene-indices i j k` - Process only these scene indices
- `--profile-indices i j k` - Process only these profile indices

**GPU**
- `CUDA_VISIBLE_DEVICES="X,Y"` - GPUs visible to system
- `--gpu-id N` - Single GPU for Habitat simulation and semantic similarity (default: 0)